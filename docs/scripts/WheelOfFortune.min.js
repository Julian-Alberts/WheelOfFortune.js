var __extends=this&&this.__extends||function(){var n=function(t,i){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)if(i.hasOwnProperty(e))t[e]=i[e]};return n(t,i)};return function(t,i){n(t,i);function e(){this.constructor=t}t.prototype=i===null?Object.create(i):(e.prototype=i.prototype,new e)}}();var Indicator=function(){function t(t,i,e){this._color=t;this._width=i;this._height=e}return t}();var StaticIndicator=function(t){__extends(i,t);function i(){return t!==null&&t.apply(this,arguments)||this}i.prototype.render=function(t){var i=(this._width>this._height?this._height:this._width)/3;t.save();t.beginPath();t.moveTo(0,this._height-5);t.lineTo(-i,i-5);t.arcTo(i,-i-5,i,i-5,i);t.closePath();t.fillStyle=this._color;t.fill();t.restore()};return i}(Indicator);var WheelOfFortune=function(){function t(t,i,e){var n=this;if(e===void 0){e={}}this._sectionData=i;this._currentRotation=0;this._winCallback=function(){};this._config=e=this._fillConfig(e);if(t.tagName==="CANVAS"){this._canvas=t}else{this._canvas=document.createElement("canvas")}this._config.indicator=e.indicator;if(e.indicator){switch(e.indicator.style){case"static":this._indicator=new StaticIndicator(e.indicator.color,e.indicator.width,e.indicator.height);break}}var o=(this._canvas.width>this._canvas.height?this._canvas.height:this._canvas.width)/2;this._wheelImg=this._preRenderWheelToImg(this._sectionData,o);window.requestAnimationFrame(function(){return n._render()})}t.prototype._preRenderWheelToImg=function(t,e){var n=this;e-=10;var i=new Image(e*2,e*2);var o=document.createElement("canvas");o.height=o.width=e*2;var r=o.getContext("2d");var a=Math.PI*2;var s=a/t.length;if(this._config.stroke){e-=this._config.stroke.width}r.save();r.translate(o.width/2,o.height/2);r.rotate((Math.PI+s)/-2);t.forEach(function(t,i){r.save();r.beginPath();r.rotate(s*i);r.moveTo(0,0);r.arc(0,0,e,0,s);r.fillStyle=t.backgroundColor;r.closePath();r.fill();r.rotate(s/2);r.textAlign="center";r.font=n._config.text.size+"px "+n._config.text.font;r.fillStyle=t.textColor||n._config.text.color;r.fillText(t.text,e/2,n._config.text.size/2,e-40);if(n._config.stroke){r.strokeStyle=n._config.stroke.color;r.lineWidth=n._config.stroke.width;r.stroke()}r.restore()});r.restore();if(this._config.pins&&this._config.pins.color&&this._config.pins.size>0){this._drawPins(r,t,e)}i.src=o.toDataURL("");return i};t.prototype._drawPins=function(n,t,o){var r=Math.PI*2;var a=r/t.length;var s=this._config.pins;n.save();n.translate(n.canvas.width/2,n.canvas.height/2);n.rotate((Math.PI+a)/2);this._sectionData.forEach(function(t,i){n.save();n.beginPath();var e=a*i;n.rotate(e);n.arc(-(o-s.size/2-s.margin),0,s.size,0,r);n.fillStyle=s.color;n.fill();n.closePath();n.restore()});n.restore()};t.prototype._render=function(){var t=this._canvas.getContext("2d");var i=this._canvas.width>this._canvas.height?this._canvas.height:this._canvas.width;var e=this._canvas.width;var n=this._canvas.height;t.clearRect(0,0,e,n);t.save();if(this._indicator){t.translate(e/2,n/2+this._config.indicator.height)}else{t.translate(e/2,n/2)}t.rotate(this._currentRotation);t.drawImage(this._wheelImg,-i/2,-i/2,i,i);t.restore();if(this._indicator){t.save();t.translate(e/2,(n-i)/2);this._indicator.render(t);t.restore()}};t.prototype._animateSpin=function(t){var e=this;var i=Math.PI*2;this._rotationsPerSecond-=.5/1e3*t;if(this._rotationsPerSecond>0){this._currentRotation+=i*this._rotationsPerSecond/1e3*t}this._render();if(this._rotationsPerSecond>0){window.requestAnimationFrame(function(t){var i=t-e._lastFrame;e._lastFrame=t;e._animateSpin(i)})}else{this._winCallback(this._getCurrentTopSection())}};t.prototype._getCurrentTopSection=function(){var t=Math.PI*2;var i=t/this._sectionData.length;var e=t-this._currentRotation%t;var n=~~(e/i+.5);n=n===this._sectionData.length?0:n;return this._sectionData[n]};t.prototype.spin=function(t,i){var e=this;if(t===void 0){t=2}if(i===void 0){i=5}if(this._rotationsPerSecond!=0){this._rotationsPerSecond=Math.random()*(i-t)+t;this._lastFrame=performance.now();window.requestAnimationFrame(function(t){var i=t-e._lastFrame;e._lastFrame=t;e._animateSpin(i)})}};t.prototype.setWinCallback=function(t){this._winCallback=t};t.prototype._fillConfig=function(t){if(t.indicator){t.indicator.color=t.indicator.color||"black";t.indicator.height=t.indicator.height||30;t.indicator.width=t.indicator.width||20;t.indicator.style=t.indicator.style||"none"}else{t.indicator={style:"none",color:"balck",height:30,width:20}}if(t.pins){t.pins.color=t.pins.color||"black";t.pins.margin=t.pins.margin||10;t.pins.size=t.pins.size||10}if(t.stroke){t.stroke.color=t.stroke.color||"black";t.stroke.width=t.stroke.width||1}if(!t.text){t.text={color:"black",font:"Arial",size:15}}t.text.color=t.text.color||"black";t.text.font=t.text.font||"Arial";t.text.size=t.text.size||15;return t};return t}();